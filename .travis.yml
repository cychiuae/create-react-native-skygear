sudo: required
matrix:
  include:
    - language: node_js
      cache:
        directories:
          - node_modules
      env:
        - secure: "AkGE0/YLpUCF9vqAdPy8GdE5kzbVTKERHMdgmDqGOsBDJfA4Ytb2gCR2voksQR5WM4QQzMR+JPuqjM+gN7UH4vyPzn8CRmp9TDgyeeLaHI7nUGwKpnuD6qGq4eJKLkwNfkGJm1fdlOOGOA1C7Qg9YhICyAlxkClSjUvgip9XGfnIZAsSfzT5YEFq9CZnCy3sFJYA0kYb4bkhwZzYkaAog+VVdbRF/WCKrGDljGrLltDyP+pHMKG3fR9UVAAzxSnRmLFgBcgLmqFZSGqB+t/EiuCoeTsKECj7T2rPrbhETpFrdE6oKsXE19Ngam+4/0slAE6cy4wm9KSQqHNq60mhCCSlUt/NdmZXM6SPXKgXRSqJXep2JtwyEI2J6Y/NGPw2k28wE7hZWkXOx/zhcDKE1Ix8srert89EJctApPEjOsFltumGHQurY5b3S6ugucM3ndNLHR9EmnW+i5VT+RkmN7DlCChIpfS3jP3eNz1OxfVQpQcVMSgijngzh/CtNlu+3zpx3VDd1UplBIo8ER/uyZMdnVwINMnlI5TtTtx3vzZAQ0AIVkizDK/sWtRYX8ZAf7Tsyz8b3Ln++pFwquy6Deqf3H9Pq53lNLm4CE9VieubymO88C3Y1w96fpLMUqgkjsG6ABnQrnUA/huBURHG66bJiDcjt9CukKYqnBwu2xo="
      node_js: '8'
      before_install:
        - npm i -g yarn
      install:
        - yarn
      script:
        - yarn ci-check
      before_deploy:
        - yarn build
      deploy:
        provider: npm
        email: cychiuae@connect.ust.hk
        api_key: $NPM_PUBLISH_TOKEN
        on:
          tags: true

    - language: objective-c
      os: osx
      osx_image: xcode9.4
      env:
        - TRAVIS_NODE_VERSION="8.9.0"
      before_install:
        - rm -rf ~/.nvm && git clone https://github.com/creationix/nvm.git ~/.nvm && (cd ~/.nvm && git checkout `git describe --abbrev=0 --tags`) && source ~/.nvm/nvm.sh && nvm install $TRAVIS_NODE_VERSION
        - npm i -g yarn
        - npm i -g react-native-cli
      install:
        - yarn
      script:
        - ./scripts/integration_test.sh ios

    - language: android
      jdk: oraclejdk8
      android:
        components:
          - tools
          - tools
          - platform-tools
          - build-tools-27.0.3
          - android-22
          - extra-android-support
          - extra-android-m2repository
          - extra-google-m2repository
          - sys-img-armeabi-v7a-android-22
        licenses:
          - android-sdk-preview-license-.+
          - android-sdk-license-.+
          - google-gdk-license-.+
      cache:
        directories:
          - $HOME/.gradle/caches/
          - $HOME/.gradle/wrapper/
          - $HOME/.android/build-cache
      env:
        - TRAVIS_NODE_VERSION="8.9.0"
      before_install:
        - rm -rf ~/.nvm && git clone https://github.com/creationix/nvm.git ~/.nvm && (cd ~/.nvm && git checkout `git describe --abbrev=0 --tags`) && source ~/.nvm/nvm.sh && nvm install $TRAVIS_NODE_VERSION
        - npm i -g yarn
        - npm i -g react-native-cli
        - yes | sdkmanager "platforms;android-27"
      install:
        - yarn
      script:
        - ./scripts/integration_test.sh android

notifications:
    slack:
      secure: "JW+p0XeIp8fxmeEtbd9m1yliPk9E1nSTBQLGPEypoxZ7KiEYc49h4k9kMQBdlfY1rA+7uFNYR8EnSEh+Y1ZG8RCVUqFdAdDlfMTziUf30N8uRoIOJS6jn/dwOZf7NdQWUtIBX09SaRk7ByPuE7jKnCL6kqjg86sx6HH+74AfTyLZ0QmGALoIFHy07ZdNQnlGyJb8Ms1cmOkKTh1ENDty+mnJrjGr1NQyLa1a8E6mE0i4N0WdD0czilpLRinaDqVBaXa/630wBkxJNa7RM36Yz/mw2+7I7YQAW9RTmp+WAq19jMaN2qMccPvmedUuE7GvjQVe9QbiLDZzoJxRsWHRdsJiQNr+R7aKPL4t5LIMUw+SrEGuzRiQLNyiQgSK6lqlWo0t/SWGa4ZHlFT7tEbH1cmnVzj24Zb3zILwMHVB33kBd5jNjpfloM6txnRIRQONOQX1/PE/icSwTTH5YMLJWUZYF6CQukO9mEdbHkUw9LW/H/TDNw0vg3u7lM2E0/GIzLB32ogs4P7uGYnLa/BQYQXNug5hfVHQGWbSvkT77bgx3PHdRQKh5OwF7ILHULNaRTSC8HbYlVrg2L2HSIyexbrAj1EyH7Xzl/ZHFP8pJ+kaKxzqRdN7/Ir9oe5A8L+hqJkYQz/UtUsQpf+cokGU9lL+tMAHw2wdayO2Zrj9dDQ="
